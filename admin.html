<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Admin Panel ‚Äì Tracer Study</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --p:#5B21B6;--a:#8B5CF6;--a2:#C4B5FD;--go:#F59E0B;
  --bg:#0D0A1A;--s1:#160F2E;--s2:#1E1442;
  --bd:rgba(139,92,246,0.18);--tx:#EDE9FE;--mu:#A78BFA;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--tx);
  background-image:radial-gradient(ellipse 70% 40% at 50% -10%,rgba(91,33,182,.3) 0%,transparent 55%);}

/* LOGIN */
#lw{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;}
.lc{background:rgba(22,15,46,.95);border:1px solid rgba(139,92,246,.35);border-radius:20px;padding:2.4rem;width:100%;max-width:370px;box-shadow:0 20px 70px rgba(91,33,182,.35);backdrop-filter:blur(20px);}
.lic{width:50px;height:50px;border-radius:13px;background:linear-gradient(135deg,var(--p),var(--a));display:grid;place-items:center;font-size:1.3rem;margin-bottom:1.2rem;}
.lc h1{font-size:1.4rem;font-weight:800;margin-bottom:.25rem;}
.lc p{color:var(--mu);font-size:.83rem;margin-bottom:1.7rem;line-height:1.5;}
.flbl{font-size:.7rem;font-weight:600;letter-spacing:.06em;text-transform:uppercase;color:var(--mu);display:block;margin-bottom:.35rem;}
.fi{width:100%;padding:10px 13px;background:var(--s2);border:1px solid var(--bd);border-radius:9px;color:var(--tx);font-size:.88rem;font-family:inherit;transition:border-color .2s;}
.fi:focus{outline:none;border-color:var(--a);}
.fg{margin-bottom:1rem;}
.bl{width:100%;padding:11px;margin-top:.3rem;background:linear-gradient(135deg,var(--p),var(--a));border:none;border-radius:10px;color:#fff;font-size:.9rem;font-weight:700;cursor:pointer;font-family:inherit;transition:opacity .2s,transform .1s;}
.bl:hover{opacity:.88;transform:translateY(-1px);}
.bl:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.err{color:#f87171;font-size:.78rem;margin-top:.6rem;text-align:center;min-height:1.2em;}

/* APP LAYOUT */
#app{display:none;flex-direction:row;height:100vh;}

/* Sidebar */
.sb{width:230px;flex-shrink:0;background:rgba(16,10,38,.97);border-right:1px solid var(--bd);display:flex;flex-direction:column;overflow:hidden;}
.sbb{padding:1.1rem 1.3rem;border-bottom:1px solid var(--bd);display:flex;align-items:center;gap:9px;}
.bm{width:33px;height:33px;border-radius:9px;background:linear-gradient(135deg,var(--p),var(--a));display:grid;place-items:center;font-size:11px;font-weight:800;}
.bt{font-size:.92rem;font-weight:700;} .bt span{color:var(--a2);}
.sn{flex:1;padding:.8rem .5rem;overflow-y:auto;}
.ns{font-size:.62rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:rgba(167,139,250,.35);padding:.6rem .8rem .25rem;}
.ni{display:flex;align-items:center;gap:9px;padding:8px 11px;border-radius:8px;color:var(--mu);font-size:.81rem;font-weight:500;cursor:pointer;transition:all .18s;margin-bottom:1px;border:none;background:none;width:100%;text-align:left;font-family:inherit;}
.ni:hover{background:rgba(139,92,246,.1);color:var(--tx);}
.ni.act{background:rgba(139,92,246,.18);color:var(--a2);}
.ni svg{width:14px;height:14px;flex-shrink:0;}
.sf{padding:.9rem;border-top:1px solid var(--bd);}
.uc{display:flex;align-items:center;gap:8px;font-size:.75rem;color:var(--mu);}
.av{width:26px;height:26px;border-radius:7px;background:linear-gradient(135deg,var(--p),var(--a));display:grid;place-items:center;font-size:.65rem;font-weight:700;color:#fff;}

/* Main */
.mn{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.mh{padding:1rem 1.8rem;border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:rgba(13,10,26,.6);backdrop-filter:blur(10px);}
.mh h1{font-size:1.05rem;font-weight:700;}
.mh p{font-size:.75rem;color:var(--mu);}
.ha{display:flex;gap:.5rem;}
.btn{padding:7px 14px;border-radius:8px;font-size:.77rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all .18s;border:none;display:flex;align-items:center;gap:5px;}
.bg{background:rgba(139,92,246,.1);color:var(--a2);border:1px solid var(--bd);}.bg:hover{background:rgba(139,92,246,.2);}
.bs2{background:rgba(34,197,94,.12);color:#4ade80;border:1px solid rgba(34,197,94,.2);}.bs2:hover{background:rgba(34,197,94,.22);}
.bd2{background:rgba(239,68,68,.1);color:#f87171;border:1px solid rgba(239,68,68,.2);}.bd2:hover{background:rgba(239,68,68,.22);}
.bw2{background:rgba(245,158,11,.1);color:#fbbf24;border:1px solid rgba(245,158,11,.2);}.bw2:hover{background:rgba(245,158,11,.22);}

.mc{flex:1;overflow-y:auto;padding:1.4rem 1.8rem 3rem;}

/* Stats */
.sg{display:grid;grid-template-columns:repeat(auto-fit,minmax(145px,1fr));gap:.9rem;margin-bottom:1.8rem;}
.sk{background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:12px;padding:1.1rem;}
.sk .v{font-size:1.7rem;font-weight:800;margin-bottom:.15rem;}
.sk .l{font-size:.7rem;color:var(--mu);text-transform:uppercase;letter-spacing:.05em;}
.sk1 .v{color:var(--a2)}.sk2 .v{color:#4ade80}.sk3 .v{color:#fbbf24}.sk4 .v{color:#f87171}

/* Controls */
.tc{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;margin-bottom:.9rem;}
.sw{flex:1;min-width:170px;max-width:300px;position:relative;}
.sw svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:var(--mu);}
.si{width:100%;padding:8px 11px 8px 32px;background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:.8rem;font-family:inherit;transition:border-color .2s;}
.si:focus{outline:none;border-color:var(--a);}
.si::placeholder{color:var(--mu);}
select.fs{padding:8px 11px;background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:.8rem;cursor:pointer;font-family:inherit;}

/* Table */
.tb{background:rgba(22,15,46,.7);border:1px solid var(--bd);border-radius:13px;overflow:hidden;overflow-x:auto;backdrop-filter:blur(12px);}
table{width:100%;border-collapse:separate;border-spacing:0;font-size:.78rem;}
thead th{background:rgba(91,33,182,.18);color:var(--a2);font-size:.65rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;padding:9px 12px;border-bottom:1px solid var(--bd);white-space:nowrap;cursor:pointer;user-select:none;transition:background .15s;}
thead th:hover{background:rgba(91,33,182,.3);}
tbody tr{cursor:pointer;transition:background .12s;}
tbody tr:hover{background:rgba(139,92,246,.1);}
tbody td{padding:9px 12px;vertical-align:middle;border-bottom:1px solid rgba(139,92,246,.06);max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
tbody tr:last-child td{border-bottom:none;}
.ys td{background:rgba(91,33,182,.07)!important;border-top:2px solid rgba(139,92,246,.28)!important;border-bottom:1px solid rgba(139,92,246,.18)!important;padding:5px 12px;font-size:.67rem;font-weight:700;letter-spacing:.09em;text-transform:uppercase;color:var(--a2);font-family:'DM Mono',monospace;}
.bg2{display:inline-block;padding:2px 8px;border-radius:20px;font-size:.65rem;font-weight:600;}
.bs3{background:rgba(34,197,94,.12);color:#4ade80;}
.bw3{background:rgba(239,68,68,.12);color:#f87171;}
.bo{background:rgba(148,163,184,.1);color:#94a3b8;}
.ac{display:flex;gap:4px;}
.ib{padding:4px 8px;border-radius:6px;border:none;cursor:pointer;font-size:.7rem;font-family:inherit;transition:all .13s;}
.ie{background:rgba(245,158,11,.1);color:#fbbf24;}.ie:hover{background:rgba(245,158,11,.22);}
.id{background:rgba(239,68,68,.1);color:#f87171;}.id:hover{background:rgba(239,68,68,.22);}

/* Overlay */
.ov{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:1.2rem;opacity:0;pointer-events:none;transition:opacity .2s;}
.ov.open{opacity:1;pointer-events:all;}
.mod{background:var(--s1);border:1px solid rgba(139,92,246,.3);border-radius:17px;width:100%;max-width:620px;max-height:90vh;overflow-y:auto;transform:scale(.94);transition:transform .2s;box-shadow:0 20px 70px rgba(91,33,182,.4);}
.ov.open .mod{transform:scale(1);}
.mhh{padding:1.2rem 1.4rem .9rem;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center;}
.mhh h3{font-size:1.05rem;font-weight:700;}
.xb{width:28px;height:28px;border-radius:7px;background:rgba(139,92,246,.1);border:1px solid var(--bd);color:var(--mu);cursor:pointer;display:grid;place-items:center;font-size:.82rem;transition:background .18s;}
.xb:hover{background:rgba(239,68,68,.18);color:#f87171;}
.mbb{padding:1.2rem 1.4rem;}

/* FIX: Form grid - struktur diperbaiki */
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;}
.fgrid .frow{display:flex;flex-direction:column;gap:.3rem;}
.fgrid .frow.full{grid-column:1/-1;}
.fgrid .frow label{font-size:.67rem;font-weight:600;letter-spacing:.06em;text-transform:uppercase;color:var(--mu);}
.fgrid .frow input,
.fgrid .frow select,
.fgrid .frow textarea{
  width:100%;padding:8px 11px;
  background:rgba(30,20,66,.75);
  border:1px solid var(--bd);
  border-radius:8px;color:var(--tx);
  font-size:.82rem;font-family:inherit;
  transition:border-color .2s;
}
.fgrid .frow input:focus,
.fgrid .frow select:focus,
.fgrid .frow textarea:focus{outline:none;border-color:var(--a);}
.fgrid .frow textarea{resize:vertical;min-height:64px;}

.mff{padding:.9rem 1.4rem;border-top:1px solid var(--bd);display:flex;justify-content:flex-end;gap:.5rem;}

/* Detail */
.dg2{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;}
.di{display:flex;flex-direction:column;gap:3px;}
.di.f{grid-column:1/-1;}
.dl{font-size:.63rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--mu);}
.dv{font-size:.82rem;background:rgba(139,92,246,.06);border:1px solid var(--bd);border-radius:7px;padding:7px 10px;min-height:32px;line-height:1.45;word-break:break-word;}
.foto-wrap{border-radius:8px;overflow:hidden;border:1px solid var(--bd);margin-top:3px;}
.foto-wrap img{width:100%;max-height:220px;object-fit:cover;display:block;}
.no-foto{padding:1.5rem;text-align:center;color:var(--mu);font-size:.8rem;background:rgba(139,92,246,.05);}

/* Confirm */
.cf{text-align:center;padding:2rem;}
.cfi{font-size:2.5rem;margin-bottom:.9rem;}
.cf h3{font-size:1.1rem;font-weight:700;margin-bottom:.4rem;}
.cf p{color:var(--mu);font-size:.83rem;margin-bottom:1.4rem;line-height:1.5;}

/* Toast */
.toast{position:fixed;bottom:1.3rem;right:1.3rem;z-index:500;background:var(--s2);border:1px solid var(--bd);border-radius:11px;padding:11px 17px;font-size:.8rem;color:var(--tx);box-shadow:0 8px 30px rgba(0,0,0,.4);transform:translateY(60px);opacity:0;pointer-events:none;transition:all .28s;}
.toast.show{transform:translateY(0);opacity:1;}
.tok{border-color:rgba(34,197,94,.3)!important;color:#4ade80!important;}
.tng{border-color:rgba(239,68,68,.3)!important;color:#f87171!important;}

/* Spinner */
.spn{width:30px;height:30px;border-radius:50%;border:3px solid rgba(139,92,246,.15);border-top-color:var(--a);animation:spin .7s linear infinite;margin:2.5rem auto;}
@keyframes spin{to{transform:rotate(360deg)}}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-thumb{background:rgba(139,92,246,.35);border-radius:3px;}

/* Dashboard year box */
.dyb{background:rgba(22,15,46,.7);border:1px solid var(--bd);border-radius:12px;overflow:hidden;margin-bottom:1.3rem;}
.dyh{padding:.65rem 1rem;background:rgba(91,33,182,.12);border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between;}
.dyt{font-size:.7rem;font-weight:700;letter-spacing:.08em;color:var(--a2);font-family:'DM Mono',monospace;}
.dym{font-size:.7rem;color:var(--mu);font-family:'DM Mono',monospace;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="lw">
  <div class="lc">
    <div class="lic">üîê</div>
    <h1>Admin Panel</h1>
    <p>Masukkan password untuk mengakses panel administrasi data alumni.</p>
    <div class="fg">
      <label class="flbl">Password</label>
      <input id="lpw" class="fi" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <button class="bl" id="lbtn" onclick="doLogin()">Masuk ‚Üí</button>
    <div class="err" id="lerr"></div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <!-- Sidebar -->
  <aside class="sb">
    <div class="sbb"><div class="bm">TS</div><span class="bt">Tracer <span>Study</span></span></div>
    <nav class="sn">
      <div class="ns">Menu</div>
      <button class="ni act" id="nD" onclick="showP('dash')">
        <svg viewBox="0 0 20 20" fill="currentColor"><path d="M2 4a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2H4a2 2 0 01-2-2V4zm0 9a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2H4a2 2 0 01-2-2v-3zm9-9a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2h-3a2 2 0 01-2-2V4zm0 9a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2h-3a2 2 0 01-2-2v-3z"/></svg>
        Dashboard
      </button>
      <button class="ni" id="nDt" onclick="showP('data')">
        <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h14a1 1 0 001-1V5a1 1 0 00-1-1H3zm1 2h12v8H4V6z"/></svg>
        Data Alumni
      </button>
      <div class="ns">Aksi</div>
      <button class="ni" onclick="openAdd()">
        <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/></svg>
        Tambah Alumni
      </button>
      <button class="ni" onclick="reload()">
        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/></svg>
        Refresh
      </button>
      <div class="ns">Navigasi</div>
      <a href="index.html" class="ni">
        <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
        Halaman Publik
      </a>
    </nav>
    <div class="sf"><div class="uc"><div class="av">A</div><span>Administrator</span></div></div>
  </aside>

  <!-- Main -->
  <main class="mn">
    <div class="mh">
      <div><h1 id="pt">Dashboard</h1><p id="ps">Ringkasan data alumni</p></div>
      <div class="ha">
        <button class="btn bg" onclick="reload()">‚Üª Refresh</button>
        <button class="btn bs2" onclick="openAdd()">Ôºã Tambah</button>
      </div>
    </div>
    <div class="mc">

      <!-- DASHBOARD PANEL -->
      <div id="pDash">
        <div class="sg">
          <div class="sk sk1"><div class="v" id="sv1">‚Äî</div><div class="l">Total Alumni</div></div>
          <div class="sk sk2"><div class="v" id="sv2">‚Äî</div><div class="l">Melanjutkan Studi</div></div>
          <div class="sk sk3"><div class="v" id="sv3">‚Äî</div><div class="l">Berwirausaha</div></div>
          <div class="sk sk4"><div class="v" id="sv4">‚Äî</div><div class="l">Angkatan</div></div>
        </div>
        <div id="dbody"><div class="spn"></div></div>
      </div>

      <!-- DATA PANEL -->
      <div id="pData" style="display:none">
        <div class="tc">
          <div class="sw">
            <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg>
            <input id="aS" class="si" placeholder="Cari‚Ä¶" oninput="aFilt()"/>
          </div>
          <select id="aY" class="fs" onchange="aFilt()"><option value="">Semua Tahun</option></select>
          <select id="aJ" class="fs" onchange="aFilt()"><option value="">Semua Jurusan</option></select>
        </div>
        <div class="tb">
          <div id="tld"><div class="spn"></div></div>
          <table id="atbl" style="display:none">
            <thead><tr>
              <th onclick="aSort('nama')">Nama ‚Üï</th>
              <th onclick="aSort('nisn')">NISN ‚Üï</th>
              <th onclick="aSort('tahunLulus')">Tahun ‚Üï</th>
              <th>Jurusan</th><th>TTL</th><th>HP/WA</th>
              <th>Alamat</th><th>Rutinitas</th>
              <th>Studi?</th><th>Studi Dimana</th><th>Wirausaha</th>
              <th style="min-width:80px">Aksi</th>
            </tr></thead>
            <tbody id="atb"></tbody>
          </table>
        </div>
        <p id="acnt" style="font-size:.72rem;color:var(--mu);margin-top:.5rem;"></p>
      </div>

    </div>
  </main>
</div>

<!-- EDIT/ADD MODAL ‚Äî struktur form diperbaiki -->
<div class="ov" id="ovE" onclick="if(event.target.id==='ovE')cOv('ovE')">
  <div class="mod">
    <div class="mhh"><h3 id="etitle">Tambah Alumni</h3><button class="xb" onclick="cOv('ovE')">‚úï</button></div>
    <div class="mbb">
      <div class="fgrid">
        <div class="frow">
          <label>Nama</label>
          <input id="ef_nama" placeholder="Nama lengkap"/>
        </div>
        <div class="frow">
          <label>NISN</label>
          <input id="ef_nisn" placeholder="NISN"/>
        </div>
        <div class="frow">
          <label>Tahun Lulus</label>
          <input id="ef_tahunLulus" type="number" placeholder="2024"/>
        </div>
        <div class="frow">
          <label>Jurusan</label>
          <input id="ef_jurusan" placeholder="Nama jurusan"/>
        </div>
        <div class="frow full">
          <label>Tempat, Tanggal Lahir</label>
          <input id="ef_ttl" placeholder="Kota, DD/MM/YYYY"/>
        </div>
        <div class="frow">
          <label>No HP / WA</label>
          <input id="ef_hp" placeholder="08xxxxxxxxxx"/>
        </div>
        <div class="frow">
          <label>Melanjutkan Studi?</label>
          <select id="ef_melanjutkanStudi">
            <option value="">‚Äî pilih ‚Äî</option>
            <option value="Ya">Ya</option>
            <option value="Tidak">Tidak</option>
          </select>
        </div>
        <div class="frow full">
          <label>Alamat Domisili</label>
          <textarea id="ef_alamat"></textarea>
        </div>
        <div class="frow full">
          <label>Rutinitas Keseharian</label>
          <textarea id="ef_rutinitas"></textarea>
        </div>
        <div class="frow full">
          <label>Jika Studi, Dimana?</label>
          <input id="ef_studioMana" placeholder="Nama kampus / universitas"/>
        </div>
        <div class="frow full">
          <label>Jika Berwirausaha, Tuliskan</label>
          <textarea id="ef_wirausaha"></textarea>
        </div>
        <div class="frow full">
          <label>Link Foto Tempat Usaha</label>
          <input id="ef_fotoUsaha" placeholder="https://‚Ä¶"/>
        </div>
      </div>
    </div>
    <div class="mff">
      <button class="btn bg" onclick="cOv('ovE')">Batal</button>
      <button class="btn bs2" onclick="saveRow()">üíæ Simpan</button>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="ov" id="ovDt" onclick="if(event.target.id==='ovDt')cOv('ovDt')">
  <div class="mod">
    <div class="mhh">
      <div>
        <h3 id="dtN">‚Äî</h3>
        <p id="dtSub" style="font-size:.75rem;color:var(--mu);margin-top:3px;">‚Äî</p>
      </div>
      <button class="xb" onclick="cOv('ovDt')">‚úï</button>
    </div>
    <div class="mbb"><div class="dg2" id="dtG"></div></div>
  </div>
</div>

<!-- CONFIRM DELETE -->
<div class="ov" id="ovC">
  <div class="mod" style="max-width:340px">
    <div class="cf">
      <div class="cfi">üóëÔ∏è</div>
      <h3>Hapus Data?</h3>
      <p>Data ini akan <strong>dihapus permanen</strong> dan tidak dapat dikembalikan.</p>
      <div style="display:flex;gap:.6rem;justify-content:center">
        <button class="btn bg" onclick="cOv('ovC')">Batal</button>
        <button class="btn bd2" onclick="doDel()">Hapus</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="config.js"></script>
<script src="api.js"></script>
<script>
var pw='', allData=[], editRow=null, delId=null, asf='tahunLulus', asd=1;

// FIX: daftar field harus konsisten dengan key di GAS (studioMana bukan studiMana)
const EF = ['nama','nisn','tahunLulus','jurusan','ttl','hp','alamat','rutinitas','melanjutkanStudi','studioMana','wirausaha','fotoUsaha'];

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
async function doLogin() {
  const p = document.getElementById('lpw').value.trim();
  if (!p) { document.getElementById('lerr').textContent = 'Masukkan password!'; return; }
  const btn = document.getElementById('lbtn');
  btn.disabled = true; btn.textContent = 'Memeriksa‚Ä¶';
  document.getElementById('lerr').textContent = '';
  try {
    if (CONFIG.API_URL === 'GANTI_DENGAN_URL_GAS_ANDA') {
      document.getElementById('lerr').textContent = '‚ö†Ô∏è config.js belum diisi API_URL!';
      btn.disabled = false; btn.textContent = 'Masuk ‚Üí'; return;
    }
    const r = await API.verifyAdmin(p);
    if (r && r.ok) {
      pw = p;
      document.getElementById('lw').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      reload();
    } else {
      document.getElementById('lerr').textContent = '‚ùå Password salah!';
      btn.disabled = false; btn.textContent = 'Masuk ‚Üí';
    }
  } catch(e) {
    document.getElementById('lerr').textContent = '‚ö†Ô∏è Error: ' + e.message;
    btn.disabled = false; btn.textContent = 'Masuk ‚Üí';
  }
}

/* ‚îÄ‚îÄ RELOAD ‚îÄ‚îÄ */
async function reload() {
  document.getElementById('dbody').innerHTML = '<div class="spn"></div>';
  document.getElementById('tld').style.display = 'block';
  document.getElementById('atbl').style.display = 'none';
  try {
    const r = await API.getAllData();
    if (r.error) { toast(r.error, 'ng'); return; }
    allData = r.data || [];
    buildFilt();
    updStats();
    renderDash();
    aFilt();
    document.getElementById('tld').style.display = 'none';
    document.getElementById('atbl').style.display = 'table';
  } catch(e) { toast('Error: ' + e.message, 'ng'); }
}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
function updStats() {
  document.getElementById('sv1').textContent = allData.length;
  document.getElementById('sv2').textContent = allData.filter(r => r.melanjutkanStudi.toLowerCase().includes('ya')).length;
  document.getElementById('sv3').textContent = allData.filter(r => r.wirausaha.trim()).length;
  document.getElementById('sv4').textContent = [...new Set(allData.map(r => r.tahunLulus))].filter(Boolean).length;
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
function renderDash() {
  const byY = {};
  allData.forEach(r => { const y = r.tahunLulus || '‚Äî'; if (!byY[y]) byY[y] = []; byY[y].push(r); });
  const ys = Object.keys(byY).sort((a, b) => Number(a) - Number(b));
  if (!ys.length) { document.getElementById('dbody').innerHTML = '<p style="color:var(--mu);font-size:.85rem">Belum ada data.</p>'; return; }
  let h = '';
  ys.forEach(y => {
    const rows = byY[y];
    const st = rows.filter(r => r.melanjutkanStudi.toLowerCase().includes('ya')).length;
    const wu = rows.filter(r => r.wirausaha.trim()).length;
    h += `<div class="dyb"><div class="dyh"><span class="dyt">ANGKATAN ${esc(y)}</span><span class="dym">${rows.length} alumni ¬∑ ${st} studi ¬∑ ${wu} wirausaha</span></div>
    <div style="overflow-x:auto"><table><thead><tr><th>#</th><th>Nama</th><th>NISN</th><th>Jurusan</th><th>HP/WA</th><th>Alamat</th><th>Status</th></tr></thead><tbody>
    ${rows.map((r,i) => `<tr><td style="color:var(--mu);font-family:'DM Mono',monospace;font-size:.68rem">${i+1}</td><td><strong>${esc(r.nama)}</strong></td><td style="font-family:'DM Mono',monospace;font-size:.7rem">${esc(r.nisn)}</td><td>${esc(r.jurusan)}</td><td>${esc(r.hp)}</td><td>${esc(r.alamat)}</td><td>${badge(r)}</td></tr>`).join('')}
    </tbody></table></div></div>`;
  });
  document.getElementById('dbody').innerHTML = h;
}

/* ‚îÄ‚îÄ ADMIN TABLE ‚îÄ‚îÄ */
function buildFilt() {
  const ys = [...new Set(allData.map(r => r.tahunLulus))].filter(Boolean).sort();
  const js = [...new Set(allData.map(r => r.jurusan))].filter(Boolean).sort();
  const ySel = document.getElementById('aY'), jSel = document.getElementById('aJ');
  while (ySel.options.length > 1) ySel.remove(1);
  while (jSel.options.length > 1) jSel.remove(1);
  ys.forEach(y => { const o = document.createElement('option'); o.value = y; o.textContent = y; ySel.appendChild(o); });
  js.forEach(j => { const o = document.createElement('option'); o.value = j; o.textContent = j; jSel.appendChild(o); });
}

function aFilt() {
  const q  = document.getElementById('aS').value.toLowerCase();
  const yr = document.getElementById('aY').value;
  const jr = document.getElementById('aJ').value;
  let d = allData.filter(r => {
    if (q && !(r.nama + ' ' + r.nisn + ' ' + r.jurusan).toLowerCase().includes(q)) return false;
    if (yr && r.tahunLulus != yr) return false;
    if (jr && r.jurusan !== jr) return false;
    return true;
  });
  d.sort((a, b) => {
    const va = String(a[asf] || '').toLowerCase(), vb = String(b[asf] || '').toLowerCase();
    if (!isNaN(va) && !isNaN(vb)) return (Number(va) - Number(vb)) * asd;
    return va.localeCompare(vb) * asd;
  });
  renderT(d);
  document.getElementById('acnt').textContent = `Menampilkan ${d.length} dari ${allData.length} data`;
}

function aSort(f) { if (asf === f) asd *= -1; else { asf = f; asd = 1; } aFilt(); }

function renderT(data) {
  const tb = document.getElementById('atb');
  if (!data.length) { tb.innerHTML = '<tr><td colspan="12" style="text-align:center;color:var(--mu);padding:2rem">Tidak ada data</td></tr>'; return; }
  let h = '', lastY = null;
  data.forEach((r, i) => {
    const y = r.tahunLulus || '‚Äî';
    if (y !== lastY) {
      if (i > 0) h += `<tr class="ys"><td colspan="12">‚îÄ‚îÄ ANGKATAN ${esc(y)} ‚îÄ‚îÄ</td></tr>`;
      lastY = y;
    }
    h += `<tr onclick="openDet('${r.id}')">
      <td title="${esc(r.nama)}"><strong>${esc(r.nama)}</strong></td>
      <td style="font-family:'DM Mono',monospace;font-size:.7rem">${esc(r.nisn)}</td>
      <td style="font-family:'DM Mono',monospace">${esc(r.tahunLulus)}</td>
      <td>${esc(r.jurusan)}</td><td>${esc(r.ttl)}</td><td>${esc(r.hp)}</td>
      <td>${esc(r.alamat)}</td><td>${esc(r.rutinitas)}</td><td>${badge(r)}</td>
      <td>${esc(r.studioMana)}</td><td>${esc(r.wirausaha)}</td>
      <td onclick="event.stopPropagation()" class="ac">
        <button class="ib ie" onclick="openEd('${r.id}')">‚úé</button>
        <button class="ib id" onclick="askDel('${r.id}')">‚úï</button>
      </td></tr>`;
  });
  tb.innerHTML = h;
}

/* ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ */
function openDet(id) {
  const r = allData.find(x => String(x.id) === String(id)); if (!r) return;
  document.getElementById('dtN').textContent  = r.nama;
  document.getElementById('dtSub').textContent = (r.jurusan||'‚Äî') + ' ¬∑ Lulus ' + (r.tahunLulus||'‚Äî');
  const flds = [
    ['NISN',              r.nisn,            false],
    ['Tahun Lulus',       r.tahunLulus,       false],
    ['Jurusan',           r.jurusan,          false],
    ['TTL',               r.ttl,              false],
    ['HP/WA',             r.hp,               false],
    ['Melanjutkan Studi', r.melanjutkanStudi, false],
    ['Alamat',            r.alamat,           true ],
    ['Rutinitas',         r.rutinitas,        true ],
    ['Studi Dimana',      r.studioMana,       false],
    ['Wirausaha',         r.wirausaha,        true ],
  ];
  let h = flds.map(([l,v,f]) =>
    `<div class="di ${f?'f':''}"><span class="dl">${l}</span><div class="dv">${esc(v)||'‚Äî'}</div></div>`
  ).join('');

  // Foto usaha ‚Äî selalu tampil, ada atau tidak
  h += `<div class="di f">
    <span class="dl">Foto Tempat Usaha</span>
    <div class="foto-wrap">
      ${r.fotoUsaha
        ? `<img src="${esc(r.fotoUsaha)}" alt="Foto usaha"
             onerror="this.outerHTML='<div class=\\'no-foto\\'>‚ö†Ô∏è Foto tidak dapat dimuat</div>'">`
        : `<div class="no-foto">üì∑ Tidak ada foto</div>`
      }
    </div>
  </div>`;

  document.getElementById('dtG').innerHTML = h;
  oOv('ovDt');
}

/* ‚îÄ‚îÄ ADD / EDIT ‚îÄ‚îÄ */
function openAdd() {
  editRow = null;
  document.getElementById('etitle').textContent = 'Tambah Alumni Baru';
  EF.forEach(f => { const el = document.getElementById('ef_' + f); if (el) el.value = ''; });
  oOv('ovE');
  showP('data');
}

function openEd(id) {
  const r = allData.find(x => String(x.id) === String(id)); if (!r) return;
  editRow = r;
  document.getElementById('etitle').textContent = 'Edit: ' + r.nama;
  EF.forEach(f => { const el = document.getElementById('ef_' + f); if (el) el.value = r[f] || ''; });
  oOv('ovE');
}

async function saveRow() {
  const rd = { id: editRow ? editRow.id : null };
  EF.forEach(f => { const el = document.getElementById('ef_' + f); rd[f] = el ? el.value : ''; });
  if (!rd.nama.trim()) { toast('Nama harus diisi!', 'ng'); return; }
  try {
    const r = editRow ? await API.updateRow(rd, pw) : await API.addRow(rd, pw);
    if (r.error) { toast(r.error, 'ng'); return; }
    toast(editRow ? 'Data diperbarui!' : 'Data ditambahkan!', 'ok');
    cOv('ovE'); reload();
  } catch(e) { toast('Error: ' + e.message, 'ng'); }
}

/* ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ */
function askDel(id) { delId = id; oOv('ovC'); }
async function doDel() {
  try {
    const r = await API.deleteRow(delId, pw);
    if (r.error) { toast(r.error, 'ng'); return; }
    toast('Data dihapus!', 'ok'); cOv('ovC'); reload();
  } catch(e) { toast('Error: ' + e.message, 'ng'); }
}

/* ‚îÄ‚îÄ PANEL SWITCH ‚îÄ‚îÄ */
function showP(n) {
  document.getElementById('pDash').style.display = n === 'dash' ? 'block' : 'none';
  document.getElementById('pData').style.display = n === 'data' ? 'block' : 'none';
  document.getElementById('nD').className  = 'ni' + (n === 'dash' ? ' act' : '');
  document.getElementById('nDt').className = 'ni' + (n === 'data' ? ' act' : '');
  document.getElementById('pt').textContent = n === 'dash' ? 'Dashboard' : 'Data Alumni';
  document.getElementById('ps').textContent = n === 'dash' ? 'Ringkasan data alumni' : 'Kelola data alumni';
}

/* ‚îÄ‚îÄ OVERLAY ‚îÄ‚îÄ */
function oOv(id) { document.getElementById(id).classList.add('open'); document.body.style.overflow = 'hidden'; }
function cOv(id) { document.getElementById(id).classList.remove('open'); document.body.style.overflow = ''; }
document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.ov.open').forEach(el => el.classList.remove('open')); });

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
function toast(msg, type) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show' + (type ? ' t' + type : '');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.className = 'toast', 2800);
}

/* ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ */
function badge(r) {
  const s = (r.melanjutkanStudi || '').toLowerCase();
  if (s.includes('ya')) return '<span class="bg2 bs3">Studi</span>';
  if (r.wirausaha && r.wirausaha.trim()) return '<span class="bg2 bw3">Wirausaha</span>';
  return '<span class="bg2 bo">‚Äî</span>';
}
function esc(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
</script>
</body>
</html>
