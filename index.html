<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Tracer Study Alumni</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --p:#5B21B6;--a:#8B5CF6;--a2:#C4B5FD;--go:#F59E0B;
  --bg:#0D0A1A;--s1:#160F2E;--s2:#1E1442;
  --bd:rgba(139,92,246,0.18);--tx:#EDE9FE;--mu:#A78BFA;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Plus Jakarta Sans',sans-serif;
  background:var(--bg);color:var(--tx);min-height:100vh;
  background-image:
    radial-gradient(ellipse 80% 50% at 50% -20%,rgba(91,33,182,.35) 0%,transparent 60%),
    radial-gradient(ellipse 40% 30% at 80% 90%,rgba(139,92,246,.12) 0%,transparent 50%);
}
/* HEADER */
.hdr{
  position:sticky;top:0;z-index:40;
  background:rgba(13,10,26,.9);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--bd);
}
.hdr-in{
  max-width:1400px;margin:0 auto;padding:0 1.5rem;
  display:flex;align-items:center;justify-content:space-between;height:62px;
}
.logo{display:flex;align-items:center;gap:10px;}
.lmark{
  width:36px;height:36px;border-radius:10px;
  background:linear-gradient(135deg,var(--p),var(--a));
  display:grid;place-items:center;font-size:13px;font-weight:800;color:#fff;
}
.ltxt{font-size:1.05rem;font-weight:700;letter-spacing:-.02em;}
.ltxt span{color:var(--a2);}
.abtn{
  font-size:.78rem;color:var(--mu);text-decoration:none;
  padding:7px 16px;border:1px solid var(--bd);border-radius:20px;
  transition:all .2s;
}
.abtn:hover{background:var(--p);color:#fff;border-color:var(--p);}

/* HERO */
.hero{text-align:center;padding:3.5rem 1.5rem 2rem;max-width:680px;margin:0 auto;}
.badge{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(139,92,246,.1);border:1px solid rgba(139,92,246,.28);
  color:var(--a2);font-size:.7rem;font-weight:600;
  padding:4px 13px;border-radius:20px;margin-bottom:1.2rem;
  letter-spacing:.07em;text-transform:uppercase;
}
.hero h1{font-size:clamp(1.7rem,5vw,2.8rem);font-weight:800;line-height:1.15;letter-spacing:-.03em;margin-bottom:.8rem;}
.grad{background:linear-gradient(90deg,var(--a2),var(--go));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.hero p{color:var(--mu);font-size:.9rem;line-height:1.65;}

/* API ERROR BANNER */
.api-banner{
  max-width:900px;margin:0 auto 1rem;padding:0 1.5rem;display:none;
}
.api-banner-inner{
  background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.3);
  border-radius:12px;padding:1rem 1.2rem;
  display:flex;align-items:flex-start;gap:.8rem;
}
.api-banner-inner svg{width:18px;height:18px;color:#fbbf24;flex-shrink:0;margin-top:2px;}
.api-banner-inner p{font-size:.82rem;color:#fcd34d;line-height:1.55;}
.api-banner-inner code{background:rgba(0,0,0,.3);padding:1px 6px;border-radius:4px;font-family:'DM Mono',monospace;font-size:.78rem;}

/* STATS */
.stats{max-width:1400px;margin:0 auto 1.8rem;padding:0 1.5rem;display:flex;gap:.7rem;flex-wrap:wrap;}
.sc{background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:10px;padding:10px 16px;font-size:.77rem;color:var(--mu);}
.sc strong{display:block;font-size:1.25rem;color:var(--tx);font-weight:700;}

/* CONTROLS */
.ctrl{max-width:1400px;margin:0 auto 1.2rem;padding:0 1.5rem;display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;}
.sw{flex:1;min-width:180px;max-width:340px;position:relative;}
.sw svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:var(--mu);}
.si{width:100%;padding:9px 12px 9px 33px;background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:9px;color:var(--tx);font-size:.82rem;font-family:inherit;transition:border-color .2s;}
.si:focus{outline:none;border-color:var(--a);}
.si::placeholder{color:var(--mu);}
select.fs{padding:9px 12px;background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:9px;color:var(--tx);font-size:.82rem;cursor:pointer;font-family:inherit;}
select.fs:focus{outline:none;border-color:var(--a);}
.sb{padding:9px 14px;background:rgba(30,20,66,.75);border:1px solid var(--bd);border-radius:9px;color:var(--mu);font-size:.78rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:5px;transition:all .2s;font-family:inherit;}
.sb:hover,.sb.act{background:var(--p);color:#fff;border-color:var(--p);}

/* TABLE */
.tarea{max-width:1400px;margin:0 auto;padding:0 1.5rem 4rem;}
.ygrp{margin-bottom:2.2rem;}
.ydiv{display:flex;align-items:center;gap:.8rem;margin-bottom:.8rem;}
.ytag{background:linear-gradient(135deg,var(--p),var(--a));color:#fff;font-size:.71rem;font-weight:700;padding:4px 13px;border-radius:20px;letter-spacing:.08em;white-space:nowrap;font-family:'DM Mono',monospace;}
.yline{flex:1;height:1px;background:linear-gradient(90deg,rgba(139,92,246,.4),transparent);}
.ycnt{font-size:.7rem;color:var(--mu);white-space:nowrap;font-family:'DM Mono',monospace;}
.tbox{background:rgba(22,15,46,.72);border:1px solid var(--bd);border-radius:13px;overflow:hidden;overflow-x:auto;backdrop-filter:blur(12px);}
table{width:100%;border-collapse:separate;border-spacing:0;font-size:.81rem;}
thead th{background:rgba(91,33,182,.2);color:var(--a2);font-size:.67rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;padding:10px 13px;border-bottom:1px solid var(--bd);white-space:nowrap;position:sticky;top:63px;z-index:2;}
tbody tr{cursor:pointer;transition:background .13s,transform .1s;}
tbody tr:hover{background:rgba(139,92,246,.11);transform:translateY(-1px);}
tbody td{padding:11px 13px;vertical-align:middle;border-bottom:1px solid rgba(139,92,246,.07);max-width:170px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
tbody tr:last-child td{border-bottom:none;}
.rn{color:var(--mu);font-family:'DM Mono',monospace;font-size:.68rem;}
.bgs{display:inline-block;padding:2px 9px;border-radius:20px;font-size:.67rem;font-weight:600;}
.bst{background:rgba(34,197,94,.12);color:#4ade80;}
.bwu{background:rgba(239,68,68,.12);color:#f87171;}
.bot{background:rgba(148,163,184,.1);color:#94a3b8;}

/* MODAL */
.mov{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.72);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:1.5rem;opacity:0;pointer-events:none;transition:opacity .2s;}
.mov.open{opacity:1;pointer-events:all;}
.mcard{background:var(--s1);border:1px solid rgba(139,92,246,.3);border-radius:18px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;transform:scale(.95) translateY(8px);transition:transform .2s;box-shadow:0 25px 80px rgba(91,33,182,.4);}
.mov.open .mcard{transform:scale(1) translateY(0);}
.mhd{padding:1.3rem 1.5rem 1rem;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:flex-start;}
.mhd h2{font-size:1.15rem;font-weight:700;}
.mhd p{color:var(--mu);font-size:.78rem;margin-top:3px;}
.xb{width:30px;height:30px;border-radius:7px;background:rgba(139,92,246,.1);border:1px solid var(--bd);color:var(--mu);cursor:pointer;display:grid;place-items:center;font-size:.85rem;transition:background .2s;flex-shrink:0;}
.xb:hover{background:rgba(239,68,68,.18);color:#f87171;}
.mbd{padding:1.3rem 1.5rem;}
.dg{display:grid;grid-template-columns:1fr 1fr;gap:.85rem;}
.di{display:flex;flex-direction:column;gap:3px;}
.di.f{grid-column:1/-1;}
.dl{font-size:.63rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--mu);}
.dv{font-size:.85rem;background:rgba(139,92,246,.06);border:1px solid var(--bd);border-radius:7px;padding:8px 11px;min-height:34px;line-height:1.45;}

/* LOADING */
.lds{text-align:center;padding:5rem 2rem;color:var(--mu);}
.spn{width:34px;height:34px;border-radius:50%;border:3px solid var(--bd);border-top-color:var(--a);animation:spin .7s linear infinite;margin:0 auto 1rem;}
@keyframes spin{to{transform:rotate(360deg)}}
.emp{text-align:center;padding:4rem 2rem;color:var(--mu);font-size:.88rem;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-thumb{background:rgba(139,92,246,.38);border-radius:3px;}
</style>
</head>
<body>

<header class="hdr">
  <div class="hdr-in">
    <div class="logo">
      <div class="lmark">TS</div>
      <span class="ltxt">Tracer <span>Study</span></span>
    </div>
    <a href="admin.html" class="abtn">‚öôÔ∏è Admin Panel</a>
  </div>
</header>

<!-- API NOT CONFIGURED BANNER -->
<div class="api-banner" id="apiBanner">
  <div class="api-banner-inner">
    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
    <p>
      <strong>API belum dikonfigurasi.</strong> Buka file <code>config.js</code> dan isi <code>API_URL</code> dengan URL deployment Google Apps Script Anda, lalu commit ke GitHub.
    </p>
  </div>
</div>

<div class="hero">
  <div class="badge">‚óè Data Alumni</div>
  <h1>Direktori <span class="grad">Alumni</span><br>Tracer Study</h1>
  <p>Telusuri data lengkap alumni berdasarkan tahun lulus, jurusan, dan status pasca kelulusan.</p>
</div>

<div class="stats" id="stats" style="display:none">
  <div class="sc"><strong id="s1">0</strong>Total Alumni</div>
  <div class="sc"><strong id="s2">0</strong>Angkatan</div>
  <div class="sc"><strong id="s3">0</strong>Jurusan</div>
  <div class="sc"><strong id="s4">0</strong>Melanjutkan Studi</div>
</div>

<div class="ctrl" id="ctrl" style="display:none">
  <div class="sw">
    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg>
    <input id="qS" class="si" placeholder="Cari nama, NISN, jurusan‚Ä¶" oninput="filterRender()"/>
  </div>
  <select id="qY" class="fs" onchange="filterRender()"><option value="">Semua Tahun</option></select>
  <select id="qJ" class="fs" onchange="filterRender()"><option value="">Semua Jurusan</option></select>
  <select id="qSt" class="fs" onchange="filterRender()">
    <option value="">Semua Status</option>
    <option value="ya">Melanjutkan Studi</option>
    <option value="tidak">Tidak / Wirausaha</option>
  </select>
  <button class="sb" id="bN" onclick="tSort('nama')">‚Üï Nama</button>
  <button class="sb" id="bT" onclick="tSort('tahunLulus')">‚Üï Tahun</button>
</div>

<div class="tarea" id="tarea">
  <div class="lds"><div class="spn"></div><p>Memuat data alumni‚Ä¶</p></div>
</div>

<!-- MODAL -->
<div class="mov" id="modal" onclick="if(event.target.id==='modal')closeMod()">
  <div class="mcard">
    <div class="mhd">
      <div><h2 id="mNama">‚Äî</h2><p id="mSub">‚Äî</p></div>
      <button class="xb" onclick="closeMod()">‚úï</button>
    </div>
    <div class="mbd"><div class="dg" id="mGrid"></div></div>
  </div>
</div>

<script src="config.js"></script>
<script src="api.js"></script>
<script>
var allData=[], sf='tahunLulus', sd=1;

// Cek konfigurasi
if (!CONFIG.API_URL || CONFIG.API_URL === 'GANTI_DENGAN_URL_GAS_ANDA') {
  document.getElementById('apiBanner').style.display = 'block';
  document.getElementById('tarea').innerHTML = '<div class="emp">‚öôÔ∏è Silakan konfigurasi <strong>config.js</strong> terlebih dahulu.</div>';
} else {
  loadData();
}

async function loadData() {
  try {
    const res = await API.getAllData();
    if (res.error) { showErr(res.error); return; }
    allData = res.data || [];
    buildFilters();
    renderStats();
    filterRender();
    document.getElementById('stats').style.display = 'flex';
    document.getElementById('ctrl').style.display = 'flex';
  } catch(e) {
    showErr('Gagal menghubungi server: ' + e.message);
  }
}

function showErr(m) {
  document.getElementById('tarea').innerHTML = '<div class="emp">‚ö†Ô∏è ' + esc(m) + '</div>';
}

function renderStats() {
  document.getElementById('s1').textContent = allData.length;
  document.getElementById('s2').textContent = [...new Set(allData.map(r=>r.tahunLulus))].filter(Boolean).length;
  document.getElementById('s3').textContent = [...new Set(allData.map(r=>r.jurusan))].filter(Boolean).length;
  document.getElementById('s4').textContent = allData.filter(r=>r.melanjutkanStudi.toLowerCase().includes('ya')).length;
}

function buildFilters() {
  const years = [...new Set(allData.map(r=>r.tahunLulus))].filter(Boolean).sort();
  const jurs  = [...new Set(allData.map(r=>r.jurusan))].filter(Boolean).sort();
  const ys = document.getElementById('qY');
  const js = document.getElementById('qJ');
  years.forEach(y=>{const o=document.createElement('option');o.value=y;o.textContent=y;ys.appendChild(o);});
  jurs.forEach(j=>{const o=document.createElement('option');o.value=j;o.textContent=j;js.appendChild(o);});
}

function filterRender() {
  const q  = document.getElementById('qS').value.toLowerCase();
  const yr = document.getElementById('qY').value;
  const jr = document.getElementById('qJ').value;
  const st = document.getElementById('qSt').value;
  let d = allData.filter(r=>{
    if(q && !(r.nama+' '+r.nisn+' '+r.jurusan+' '+r.alamat).toLowerCase().includes(q)) return false;
    if(yr && r.tahunLulus != yr) return false;
    if(jr && r.jurusan !== jr) return false;
    if(st==='ya'    && !r.melanjutkanStudi.toLowerCase().includes('ya')) return false;
    if(st==='tidak' &&  r.melanjutkanStudi.toLowerCase().includes('ya')) return false;
    return true;
  });
  d.sort((a,b)=>{
    const va=String(a[sf]||'').toLowerCase(), vb=String(b[sf]||'').toLowerCase();
    if(!isNaN(va)&&!isNaN(vb)) return (Number(va)-Number(vb))*sd;
    return va.localeCompare(vb)*sd;
  });
  renderTable(d);
}

function tSort(f) {
  if(sf===f) sd*=-1; else{sf=f;sd=1;}
  document.querySelectorAll('.sb').forEach(b=>b.classList.remove('act'));
  document.getElementById(f==='nama'?'bN':'bT').classList.add('act');
  filterRender();
}

function renderTable(data) {
  const area = document.getElementById('tarea');
  if(!data.length){area.innerHTML='<div class="emp">üîç Tidak ada data yang sesuai filter.</div>';return;}
  const byYear={};
  data.forEach(r=>{const y=r.tahunLulus||'‚Äî';if(!byYear[y])byYear[y]=[];byYear[y].push(r);});
  const years=Object.keys(byYear).sort((a,b)=>Number(a)-Number(b));
  let html='';
  years.forEach(yr=>{
    const rows=byYear[yr];
    html+=`<div class="ygrp">
      <div class="ydiv">
        <span class="ytag">ANGKATAN ${esc(yr)}</span>
        <div class="yline"></div>
        <span class="ycnt">${rows.length} alumni</span>
      </div>
      <div class="tbox"><table>
        <thead><tr><th>#</th><th>Nama</th><th>NISN</th><th>Jurusan</th><th>TTL</th><th>HP/WA</th><th>Alamat</th><th>Status</th></tr></thead>
        <tbody>
          ${rows.map((r,i)=>`<tr onclick='openMod(${JSON.stringify(r).replace(/'/g,"\\'")})'><td class="rn">${i+1}</td><td><strong>${esc(r.nama)}</strong></td><td style="font-family:'DM Mono',monospace;font-size:.72rem">${esc(r.nisn)}</td><td>${esc(r.jurusan)}</td><td>${esc(r.ttl)}</td><td>${esc(r.hp)}</td><td>${esc(r.alamat)}</td><td>${badge(r)}</td></tr>`).join('')}
        </tbody>
      </table></div>
    </div>`;
  });
  area.innerHTML=html;
}

function badge(r){
  const s=(r.melanjutkanStudi||'').toLowerCase();
  if(s.includes('ya')) return '<span class="bgs bst">Studi</span>';
  if(r.wirausaha&&r.wirausaha.trim()) return '<span class="bgs bwu">Wirausaha</span>';
  return '<span class="bgs bot">‚Äî</span>';
}

function openMod(r){
  document.getElementById('mNama').textContent = r.nama||'‚Äî';
  document.getElementById('mSub').textContent  = (r.jurusan||'‚Äî')+' ¬∑ Lulus '+(r.tahunLulus||'‚Äî');
  const flds=[
    ['NISN',r.nisn,false],['Tahun Lulus',r.tahunLulus,false],
    ['Jurusan',r.jurusan,false],['Tempat, Tgl Lahir',r.ttl,false],
    ['No HP / WA',r.hp,false],['Alamat Domisili',r.alamat,true],
    ['Rutinitas Keseharian',r.rutinitas,true],['Melanjutkan Studi?',r.melanjutkanStudi,false],
    ['Jika Studi, Dimana?',r.studioMana,false],['Keterangan Wirausaha',r.wirausaha,true]
  ];
  let html=flds.map(([l,v,f])=>`<div class="di ${f?'f':''}"><span class="dl">${l}</span><div class="dv">${esc(v)||'‚Äî'}</div></div>`).join('');
  if(r.fotoUsaha) html+=`<div class="di f"><span class="dl">Foto Tempat Usaha</span><img src="${esc(r.fotoUsaha)}" style="width:100%;border-radius:8px;max-height:190px;object-fit:cover;margin-top:3px" onerror="this.style.display='none'"/></div>`;
  document.getElementById('mGrid').innerHTML=html;
  document.getElementById('modal').classList.add('open');
  document.body.style.overflow='hidden';
}
function closeMod(){document.getElementById('modal').classList.remove('open');document.body.style.overflow='';}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeMod();});
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
</script>
</body>
</html>
